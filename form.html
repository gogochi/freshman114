
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
    <title>找老師(資訊系新鮮人成長營 114)</title>
    <style>
      /* ===== 基礎重置 ===== */
      *, *::before, *::after {
        box-sizing: border-box;
      }

      html {
        -webkit-text-size-adjust: 100%;
        text-size-adjust: 100%;
        /* 增大行動裝置的根字體大小 */
        font-size: clamp(16px, 4vw, 20px);
      }

      /* ===== CSS 變數 ===== */
      :root {
        --space-2: 16px;
        --space-3: 20px;
        --space-4: 28px;
        --color-bg-page: #f3f4f6; /* 頁面背景色 */
        --color-bg-card: #ffffff; /* 卡片背景色 */
        --color-border: #d1d5db;   /* 邊框顏色 */
        --color-text-primary: #1f2937;
        --color-text-secondary: #6b7280;
        --color-accent: #2563eb;
        --color-error: #dc2626;
      }

      /* ===== 基礎布局 ===== */
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans TC', Arial, sans-serif;
        font-size: 1rem;
        color: var(--color-text-primary);
        background-color: var(--color-bg-page);
        line-height: 1.6;
        margin: 0;
        padding: var(--space-3); /* 讓卡片與螢幕邊緣有間距 */
      }

      .container {
        max-width: 640px; /* 設定內容最大寬度 */
        margin: 0 auto;   /* 讓容器置中 */
      }

      /* ===== 標題樣式 ===== */
      h1 {
        font-size: 1.75rem;
        font-weight: 600;
        margin: 0 0 var(--space-3);
        line-height: 1.3;
      }

      /* ===== 表單與結果卡片 ===== */
      .card {
        background-color: var(--color-bg-card);
        border: 1px solid var(--color-border);
        padding: var(--space-4);
        border-radius: 12px;
      }

      #result.card {
        margin-top: var(--space-3);
      }

      #dreamForm {
        border: none;
        padding: 0;
        margin: 0;
      }

      /* ===== 表單元素 ===== */
      label {
        display: block;
        margin: var(--space-2) 0 4px;
        font-weight: 600;
      }

      label:first-of-type {
        margin-top: 0;
      }

      select,
      input[type="text"],
      textarea {
        width: 100%;
        padding: 14px 16px;
        font-size: 1.1rem;
        border: 1px solid var(--color-border);
        border-radius: 8px;
        background-color: #fff; /* 確保背景是白色 */
        line-height: 1.4;
      }

      select:focus,
      input[type="text"]:focus,
      textarea:focus {
        outline: none;
        border-color: var(--color-accent);
        box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
      }

      textarea {
        min-height: 140px;
        resize: vertical;
      }

      .hint {
        color: var(--color-text-secondary);
        font-size: 0.875rem;
        font-weight: normal;
      }

      /* ===== 按鈕樣式 ===== */
      .btn {
        display: block;
        width: 100%;
        margin-top: var(--space-3);
        padding: 16px;
        font-size: 1.1rem;
        font-weight: 600;
        color: white;
        background: var(--color-accent);
        border: none;
        border-radius: 8px;
        cursor: pointer;
        min-height: 52px;
      }

      .btn:disabled {
        opacity: 0.7;
        cursor: not-allowed;
      }

      /* ===== 訊息 ===== */
      .error {
        color: var(--color-error);
        margin-top: var(--space-2);
      }

      /* ===== 結果區塊 ===== */
      #result .result-title {
        font-size: 1.125rem;
        font-weight: 600;
        margin-bottom: var(--space-2);
      }

      #result .kv {
        display: flex;
        padding: 8px 0;
        border-top: 1px solid #eee;
      }

      #result .kv:first-of-type {
        border-top: none;
      }

      #result .k {
        font-weight: 600;
        flex: 0 0 90px;
        color: var(--color-text-secondary);
      }

      #result .v a {
        color: var(--color-accent);
        word-break: break-all;
      }

      /* ===== iPhone 放大字級：針對 iOS（含 Chrome iOS，皆用 WebKit）且窄螢幕 ===== */
      @supports (-webkit-touch-callout: none) {
        @media (max-width: 430px) {
          /* 放大約 20% */
          html { font-size: clamp(22px, 6vw, 26px); }
          body { line-height: 1.7; }
          h1 { font-size: clamp(31px, 9.6vw, 41px); }
          select,
          input[type="text"],
          textarea { font-size: 1.44rem; }
          input[type="text"],
          select { min-height: 60px; }
          .btn { font-size: 1.44rem; min-height: 68px; }
          .hint { font-size: 1.2rem; }
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>找老師 (資訊系新鮮人成長營 114)</h1>
      <div class="card">
        <form id="dreamForm">
        <label for="className">班級 Class</label>
        <select id="className" name="className" required>
          <option value="">請選擇 Select…</option>
          <option>資訊一甲</option>
          <option>資訊一乙</option>
          <option>資訊一丙</option>
        </select>

        <label for="studentId">學號 Student ID</label>
        <input type="text" id="studentId" name="studentId" required />

        <label for="name">姓名 Name</label>
        <input type="text" id="name" name="name" required />

        <label for="dream">四年的學習，如果可以幫助你完成一個夢想，那會是什麼夢想? 請詳細說明<br /><span class="hint">If four years of study could help you achieve one dream, what would it be? Please elaborate.</span></label>
        <textarea id="dream" name="dream" required></textarea>

        <button class="btn" id="submitBtn" type="submit">提交 Submit</button>
        <div id="err" class="error" style="display:none"></div>
        </form>
      </div>

      <div id="result" class="card" style="display:none"></div>
    </div>

    <script>
      const $ = (id) => document.getElementById(id);

      document.getElementById('dreamForm').addEventListener('submit', function (e) {
        e.preventDefault();
        $('err').style.display = 'none';
        $('result').style.display = 'none';

        const data = {
          className: $('className').value.trim(),
          studentId: $('studentId').value.trim(),
          name: $('name').value.trim(),
          dream: $('dream').value.trim()
        };

        if (!data.className || !data.studentId || !data.name || !data.dream) {
          $('err').textContent = '請完整填寫所有欄位';
          $('err').style.display = 'block';
          return;
        }

        const btn = $('submitBtn');
        btn.disabled = true;
        btn.textContent = '分析中… Analyzing…';

        google.script.run
          .withSuccessHandler((res) => {
            btn.disabled = false;
            btn.textContent = '提交 Submit';
            const teacher = res.teacherName || '（無）';
            const reason = res.reason || '（無）';
            const web = res.web ? ('<a target="_blank" href="' + res.web + '">' + res.web + '</a>') : '（無）';
            const html = `
              <div class="result-title">建議結果</div>
              <div class="kv"><div class="k">推薦你找</div><div class="v">${teacher}</div></div>
              <div class="kv"><div class="k">推薦原因</div><div class="v">${reason}</div></div>
              <div class="kv"><div class="k">老師網頁</div><div class="v">${web}</div></div>
            `;
            $('result').innerHTML = html;
            $('result').style.display = 'block';
          })
          .withFailureHandler((err) => {
            btn.disabled = false;
            btn.textContent = '提交 Submit';
            $('err').textContent = (err && err.message) ? err.message : String(err || '未知錯誤');
            $('err').style.display = 'block';
          })
          .handleForm(data);
      });
    </script>
  </body>
  </html>
