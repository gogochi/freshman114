
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>找老師(資訊系新鮮人成長營 114)</title>
    <style>
      body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans TC', Arial, sans-serif; margin: 24px; }
      h1 { font-size: 20px; margin-bottom: 16px; }
      label { display: block; margin: 8px 0 4px; font-weight: 600; }
      select, input[type=text], textarea { width: 100%; padding: 8px; box-sizing: border-box; }
      textarea { min-height: 120px; }
      .btn { margin-top: 12px; padding: 10px 14px; background: #2563eb; color: #fff; border: none; border-radius: 6px; cursor: pointer; }
      .btn:disabled { opacity: 0.6; cursor: not-allowed; }
      .card { margin-top: 20px; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; background: #fafafa; }
      .hint { color: #6b7280; font-size: 12px; }
      .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
      .error { color: #b91c1c; margin-top: 8px; }
    </style>
  </head>
  <body>
    <h1>找老師 (資訊系新鮮人成長營 114)</h1>
    <div class="card">
      <form id="dreamForm">
        <label for="className">班級 Class</label>
        <select id="className" name="className" required>
          <option value="">請選擇 Select…</option>
          <option>資訊一甲</option>
          <option>資訊一乙</option>
          <option>資訊一丙</option>
        </select>

        <div class="row">
          <div>
            <label for="studentId">學號 Student ID</label>
            <input type="text" id="studentId" name="studentId" required />
          </div>
          <div>
            <label for="name">姓名 Name</label>
            <input type="text" id="name" name="name" required />
          </div>
        </div>

        <label for="dream">四年的學習，如果可以幫助你完成一個夢想，那會是什麼夢想? 請詳細說明<br /><span class="hint">If four years of study could help you achieve one dream, what would it be? Please elaborate.</span></label>
        <textarea id="dream" name="dream" required></textarea>

        <button class="btn" id="submitBtn" type="submit">提交 Submit</button>
        <div id="err" class="error" style="display:none"></div>
      </form>
    </div>

    <div id="result" class="card" style="display:none"></div>

    <script>
      const $ = (id) => document.getElementById(id);

      document.getElementById('dreamForm').addEventListener('submit', function (e) {
        e.preventDefault();
        $('err').style.display = 'none';
        $('result').style.display = 'none';

        const data = {
          className: $('className').value.trim(),
          studentId: $('studentId').value.trim(),
          name: $('name').value.trim(),
          dream: $('dream').value.trim()
        };

        if (!data.className || !data.studentId || !data.name || !data.dream) {
          $('err').textContent = '請完整填寫所有欄位';
          $('err').style.display = 'block';
          return;
        }

        const btn = $('submitBtn');
        btn.disabled = true;
        btn.textContent = '分析中… Analyzing…';

        google.script.run
          .withSuccessHandler((res) => {
            btn.disabled = false;
            btn.textContent = '提交 Submit';
            const html = [
              '<div><strong>推薦你找：</strong>' + (res.teacherName || '（無）') + '</div>',
              '<div><strong>推薦原因：</strong>' + (res.reason || '（無）') + '</div>',
              '<div><strong>老師網頁：</strong><a target="_blank" href="' + res.web + '">' + res.web + '</a></div>'
            ].join('');
            $('result').innerHTML = html;
            $('result').style.display = 'block';
          })
          .withFailureHandler((err) => {
            btn.disabled = false;
            btn.textContent = '提交 Submit';
            $('err').textContent = (err && err.message) ? err.message : String(err || '未知錯誤');
            $('err').style.display = 'block';
          })
          .handleForm(data);
      });
    </script>
  </body>
  </html>
