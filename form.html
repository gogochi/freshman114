
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>找老師(資訊系新鮮人成長營 114)</title>
    <style>
      *, *::before, *::after { box-sizing: border-box; }
      html { -webkit-text-size-adjust: 100%; text-size-adjust: 100%; }
      :root {
        --space-1: 8px;
        --space-2: 12px;
        --space-3: 16px;
        --radius: 10px;
        --color-border: #e5e7eb;
        --color-bg: #fafafa;
        --color-text: #111827;
        --color-muted: #6b7280;
        --color-primary: #2563eb;
        --shadow-1: 0 1px 2px rgba(0,0,0,.06), 0 4px 16px rgba(0,0,0,.06);
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans TC', Arial, sans-serif;
        color: var(--color-text);
        margin: 0;
        padding: max(var(--space-3), env(safe-area-inset-top)) 0 max(var(--space-3), env(safe-area-inset-bottom));
        background: #fff;
        line-height: 1.5;
        overflow-x: hidden; /* 防止偶發的水平捲動 */
      }

      /* 流體字級：整體隨裝置寬度微調 */
      body { font-size: clamp(14px, 3.5vw, 16px); }
      
      /* 確保手機版本有適當間距 */
      @media (max-width: 480px) {
        body { padding: var(--space-2) 0; }
        .container { padding: 0 var(--space-2); }
        .card { margin: var(--space-2) auto 0; padding: var(--space-2); }
      }

      /* 同一容器統一左右邊距與最大寬度，讓標題與卡片左緣對齊 */
      .container { max-width: 720px; margin: 0 auto; padding: 0 var(--space-3); }

      h1 {
        font-size: clamp(20px, 6vw, 28px);
        margin: 0 0 var(--space-2);
      }

      label {
        display: block;
        margin: var(--space-1) 0 4px;
        font-weight: 600;
      }

      select,
      input[type=text],
      textarea {
        width: 100%;
        padding: 10px 12px;
        box-sizing: border-box;
        border: 1px solid var(--color-border);
        border-radius: var(--radius);
        background: #fff;
        font-size: clamp(16px, 3.8vw, 18px); /* 避免 iOS 自動放大，同時隨視窗微調 */
      }

      input[type=text],
      select {
        min-height: 44px; /* 友善點擊目標 */
      }

      textarea {
        min-height: clamp(120px, 22vh, 200px);
        resize: vertical;
      }

      .btn {
        margin-top: var(--space-2);
        padding: 12px 16px;
        background: var(--color-primary);
        color: #fff;
        border: none;
        border-radius: var(--radius);
        cursor: pointer;
        width: 100%; /* 手機上滿版按鈕 */
        font-size: clamp(16px, 4vw, 18px);
      }
      .btn:hover { filter: brightness(1.05); }
      .btn:active { filter: brightness(0.95); }
      .btn:disabled { opacity: 0.6; cursor: not-allowed; }

      .card {
        margin: 16px auto 0;
        padding: var(--space-3);
        border: 1px solid var(--color-border);
        border-radius: var(--radius);
        background: var(--color-bg);
        box-shadow: var(--shadow-1);
        width: 100%;
      }

      .hint { color: var(--color-muted); font-size: 12px; }

      /* 已移除 .row 版面，保留此區塊空白避免影響其他樣式定位 */

      .error { color: #b91c1c; margin-top: var(--space-1); }

      /* 結果區塊樣式（Flex 版本） */
      #result .result-title { font-weight: 700; margin-bottom: var(--space-2); }
      #result .kv { display: flex; align-items: flex-start; padding: 6px 0; border-top: 1px dashed var(--color-border); }
      #result .kv:first-of-type { border-top: 0; }
      #result .k { color: #374151; font-weight: 600; white-space: nowrap; flex: 0 0 88px; max-width: 40%; }
      #result .v { color: #111827; flex: 1 1 auto; min-width: 0; margin-left: 12px; }
      /* 讓結果中的長網址在手機可折行 */
      #result a { overflow-wrap: anywhere; word-break: break-word; }

      

      @media (min-width: 640px) {
        h1 { font-size: clamp(22px, 3vw, 28px); }
        .btn { width: auto; }
      }

      @media (max-width: 420px) {
        #result .kv { flex-direction: column; }
        #result .v { margin-left: 0; margin-top: 4px; }
        #result .k { opacity: .9; }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>找老師 (資訊系新鮮人成長營 114)</h1>
      <div class="card">
        <form id="dreamForm">
        <label for="className">班級 Class</label>
        <select id="className" name="className" required>
          <option value="">請選擇 Select…</option>
          <option>資訊一甲</option>
          <option>資訊一乙</option>
          <option>資訊一丙</option>
        </select>

        <label for="studentId">學號 Student ID</label>
        <input type="text" id="studentId" name="studentId" required />

        <label for="name">姓名 Name</label>
        <input type="text" id="name" name="name" required />

        <label for="dream">四年的學習，如果可以幫助你完成一個夢想，那會是什麼夢想? 請詳細說明<br /><span class="hint">If four years of study could help you achieve one dream, what would it be? Please elaborate.</span></label>
        <textarea id="dream" name="dream" required></textarea>

        <button class="btn" id="submitBtn" type="submit">提交 Submit</button>
        <div id="err" class="error" style="display:none"></div>
        </form>
      </div>

      <div id="result" class="card" style="display:none"></div>
    </div>

    <script>
      const $ = (id) => document.getElementById(id);

      document.getElementById('dreamForm').addEventListener('submit', function (e) {
        e.preventDefault();
        $('err').style.display = 'none';
        $('result').style.display = 'none';

        const data = {
          className: $('className').value.trim(),
          studentId: $('studentId').value.trim(),
          name: $('name').value.trim(),
          dream: $('dream').value.trim()
        };

        if (!data.className || !data.studentId || !data.name || !data.dream) {
          $('err').textContent = '請完整填寫所有欄位';
          $('err').style.display = 'block';
          return;
        }

        const btn = $('submitBtn');
        btn.disabled = true;
        btn.textContent = '分析中… Analyzing…';

        google.script.run
          .withSuccessHandler((res) => {
            btn.disabled = false;
            btn.textContent = '提交 Submit';
            const teacher = res.teacherName || '（無）';
            const reason = res.reason || '（無）';
            const web = res.web ? ('<a target="_blank" href="' + res.web + '">' + res.web + '</a>') : '（無）';
            const html = `
              <div class="result-title">建議結果</div>
              <div class="kv"><div class="k">推薦你找</div><div class="v">${teacher}</div></div>
              <div class="kv"><div class="k">推薦原因</div><div class="v">${reason}</div></div>
              <div class="kv"><div class="k">老師網頁</div><div class="v">${web}</div></div>
            `;
            $('result').innerHTML = html;
            $('result').style.display = 'block';
          })
          .withFailureHandler((err) => {
            btn.disabled = false;
            btn.textContent = '提交 Submit';
            $('err').textContent = (err && err.message) ? err.message : String(err || '未知錯誤');
            $('err').style.display = 'block';
          })
          .handleForm(data);
      });
    </script>
  </body>
  </html>
